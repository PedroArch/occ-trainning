# <PROJECT> Storefront

## Technologies:
  *  Node.js
  *  NPM
  *  Less
  *  Hologram
  *  FontCustom

## occ-tools setup

The occ-tools was created to help the storefront development in OCC. You will need only one occ-tools that will be shared between all storefront VMs.

First, clone the project from its repository in a folder of your choice:
```bash
cd /home/myuser/my-destination-folder
git clone https://github.com/intelimen/occ-tools.git
```

Now, you must edit your `.bashrc` profile, to add a new environment variable that identifies where your occ-tools is installed:
```bash
nano ~/.bashrc
```

Append this line to your `.bashrc`, changing the value with where the occ-tools folder was installed:
```bash
export OCC_TOOLS_HOME=/home/myuser/my-destination-folder/occ-tools
```

Now, or you must close and open your terminal to flush the changes in `.bashrc`, or you can run this command to flush instantly, without having your terminal window:
```bash
source ~/.bashrc
```

## Virtual Machine (VM) setup

Download and install vagrant from the following URL:
   http://www.vagrantup.com/downloads.html

Note: **The Vagrant must be in version 1.8.5 or superior to work.**

Install virtualbox:
```bash
sudo apt-get install virtualbox
```

Install nfs:
```bash
sudo apt-get install nfs-common nfs-kernel-server
```

Start VM:
```bash
vagrant up storefront
```

And access the VM console:
```bash
vagrant ssh storefront
```

### Environment config file setup

Inside the project `storefront` folder, make a copy of `config/env.example.json` and call it `config/env.json`.
This file should contain all configuration referred to the environment being used, and should never be sent to version control.

## Development flows

**Note:** For all occ-tools commands listed below, you can run with a special `help` command to give you more details about a specific command:

```bash
occ-tools help # display general help
occ-tools help generate # display help about all generate commands
occ-tools help generate widget # display the help for generate widget command
```

### Theme development

To download all themes run:

```bash
occ-tools download theme
```

The following task will build the final LESS, upload it to OCC, download the compiled CSS, and update the style guide docs (hologram):

```bash
occ-tools generate theme
```

### Widgets development

To create a new widget from boilerplate:
```bash
occ-tools generate widget <widgetName>
```

To download all widgets run:
```bash
occ-tools download widget
```

To download only a specific widget:

```bash
occ-tools download widget <widgetName>
```

To upload a specific widget:

```bash
occ-tools upload widget <widgetName>
```

### Images

Download all images from the OCC:
```bash
occ-tools download image
```

Download an image from OCC:
```bash
occ-tools download image <imageName>
```

Upload an image to the OCC:

```bash
occ-tools upload image <imageName>
```

### FontCustom

[FontCustom](http://fontcustom.com/) is configured in the [`fontcustom.yml`](fontcustom.yml) file.

The source `.svg` files should be placed under `fontcustom/vectors` and the final LESS file will be created under `less/typograpy/fonts.less`.

To use it just execute:

```bash
fontcustom compile
```

### Hologram (style-guide)

[Hologram](http://trulia.github.io/hologram/) is configured in the [`hologram_config.yml`](hologram_config.yml) file.
The web server will be running under the `STOREFRONT_IP` configured in the [`Vagrantfile`](Vagrantfile).

New pages in the guide must be manually linked in the [`_header.html`](hologram/doc_assets/_header.html), but is always good to read the [documentation](https://github.com/trulia/hologram/blob/master/README.md) ;)

Update **only the documentation** from code (fast command):

```bash
hologram
```

Update both the documentation **and** styles (complete but slower command):

```bash
occ-tools generate theme
```

### Sprites

Sprites are automatically generated by [Sprity](https://github.com/sprity/sprity). There's a [Gulp task](gulpfile.js) configured to do all the heavy work:

```bash
occ-tools generate spritesheet
```

It will search for images under `/sprites/src`, and using the folder structure will build different sprite files.

A final `.less` file will be generated with all classes under the development folder, and sprites will be placed under the `/images` folder. **Those images need to be uploaded to OCC.**

After that, do not forget to build and publish the theme.

If you rebuild Hologram now, sprites will be documented under `/sprites.html` in the style-guide.

> Since Sprity is configured to create a special sprite for retina (@2x.png), source images must have *double size*.

### Deploy

There's a Gulp task named `deploy` that performs the upload of all Widgets (and Extensions). Typically it is used with the `--env` parameter:

```bash
occ-tools deploy
```

> PLEASE BE CAREFUL: This task is under revision. Basically what it does is automate a series of commands so we don't have to do them individually. Always review the site UI after using it.
